{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/michallaz/plepiseq_json/main/",
  "type": "object",
  "properties": {
    "output": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["tak", "nie"],
          "description": "Status wykonania pipeline: 'tak' – zakończony sukcesem; 'nie' – błąd.",
          "$comment": "Wartości dozwolone: 'tak' lub 'nie'."
        },
        "error_message": {
          "type": "string",
          "minLength": 1,
          "description": "Komunikat błędu, jeśli wykonanie pipeline zakończyło się niepowodzeniem.",
          "$comment": "Wymagany, gdy status='nie'."
        },

        "pathogen": {
          "type": "string",
          "enum": ["salmonella","escherichia","campylobacter","sars-cov-2","influenza","rsv"],
          "$comment": "Patogen z jakiego pochodzą analizowane sekwencje."
        },
        "pipeline_version": {
          "type": "string",
          "minLength": 1,
          "pattern": "^(\\d{1,2})\\.(\\d{1,2})\\.(\\d{1,2})$",
          "$comment": "Informacja o wersji pipeline stosowanego do analizy próbki."
        },
        "input_params_data": {
          "$ref": "output_subschemes_phylogenetics/input_params_data.json",
          "$comment": "Parametry uruchomienia pipeline (wejściowe)."
        },

        "ExecutionDir_dir": {
          "type": "string",
          "minLength": 2,
          "pattern": ".*/.+",
          "examples": [
            "/home/pipeline/runs/2025-11-05_12-30",
            "./runs/2025-11-05/session_A"
          ],
          "description": "Bezwzględna lub względna ścieżka, gdzie uruchomiono pipeline. Wszystkie pozostałe ścieżki są względne do tego katalogu.",
          "$comment": "Musi zawierać co najmniej jeden ukośnik '/'."
        },
        "data_uruchomienia": {
          "type": "string",
          "pattern": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])\\s(0\\d|1\\d|2[0-3]):[0-5]\\d$",
          "examples": [
            "2024-10-03 22:34",
            "2025-11-05 13:08"
          ],
          "description": "Data i czas uruchomienia w formacie YYYY-MM-DD HH:MM (czas lokalny).",
          "$comment": "Waliduje zakresy: mies. 01–12, dzień 01–31, godz. 00–23, min. 00–59."
        },

        "title": {
          "type": "string",
          "minLength": 1,
          "examples": [
            "WGS – ognisko Salmonella Enteritidis, 2025-11-05",
            "RSV – sezon 2024/25, region mazowiecki"
          ],
          "description": "Tytuł projektu Microreact podany przez użytkownika podczas uruchamiania pipeline.",
          "$comment": "Dowolny niepusty ciąg znaków."
        },

        "filogram_nwk": {
          "type": "object",
          "description": "Mapa: nazwa segmentu → ścieżka względna do pliku Newick (*.nwk) z filogramem (względem ExecutionDir_dir).",
          "minProperties": 1,
          "patternProperties": {
            "^\\S+$": {
              "type": "string",
              "minLength": 5,
              "pattern": "^(\\./)?([A-Za-z0-9._-]+/)*[A-Za-z0-9._-]+\\.nwk$",
              "examples": ["analizy/filogramy/drzewo.nwk","wyniki/tree.nwk","tree.nwk","./tree.nwk"]
            }
          },
          "additionalProperties": false,
          "$comment": "Nie może zaczynać się od '/', musi kończyć się na '.nwk'."
        },

        "microreact_json": {
          "type": "object",
          "description": "Mapa: nazwa segmentu → ścieżka względna do pliku JSON wejściowego dla Microreact (względem ExecutionDir_dir).",
          "minProperties": 1,
          "patternProperties": {
            "^\\S+$": {
              "type": "string",
              "minLength": 6,
              "pattern": "^(\\./)?([A-Za-z0-9._-]+/)*[A-Za-z0-9._-]+\\.json$",
              "examples": ["microreact/wejscie.json","viz/microreact.json","./microreact.json"]
            }
          },
          "additionalProperties": false,
          "$comment": "Nie zaczyna się od '/', musi kończyć się na '.json'."
        },

        "chronogram_nwk": {
          "type": "object",
          "description": "Mapa: nazwa segmentu → ścieżka względna do pliku Newick (*.nwk) z chronogramem (względem ExecutionDir_dir).",
          "minProperties": 1,
          "patternProperties": {
            "^\\S+$": {
              "type": "string",
              "minLength": 5,
              "pattern": "^(\\./)?([A-Za-z0-9._-]+/)*[A-Za-z0-9._-]+\\.nwk$",
              "examples": ["drzewa/chronogram.nwk","wyniki/chronogram.nwk","chronogram.nwk"]
            }
          },
          "additionalProperties": false,
          "$comment": "Plik Newick z chronogramem utworzonym na podstawie klasycznego drzewa filogenetycznego."
        },

        "sequence_filtering_data": {
          "$ref": "output_subschemes_phylogenetics/sequence_filtering_data.json",
          "$comment": "Szczegółowe wyniki modułu kontroli/filtrowania sekwencji wejściowych."
        },
        "sequence_clustering_data": {
          "$ref": "output_subschemes_phylogenetics/sequence_clustering_data.json",
          "$comment": "Wyniki modułu wykrywania duplikatów/klastrów w danych wejściowych."
        },
        "filogram_data": {
          "$ref": "output_subschemes_phylogenetics/filogram_data.json",
          "$comment": "Szczegółowe wyjście modułu budowy filogramu (drzewa filogenetycznego)."
        },
        "chronogram_data": {
          "$ref": "output_subschemes_phylogenetics/chronogram_data.json",
          "$comment": "Szczegółowe wyjście modułu budowy chronogramu (drzewa skalowanego w czasie)."
        }
      },

      "required": [
        "status",
        "pathogen",
        "pipeline_version",
        "ExecutionDir_dir",
        "data_uruchomienia",
        "input_params_data"
      ],
      "additionalProperties": false,

      "allOf": [
        {
          "if": {
            "properties": { "status": { "const": "nie" } },
            "required": ["status"]
          },
          "then": {
            "required": ["error_message"]
          }
        },
        {
          "if": {
            "properties": { "status": { "const": "tak" } },
            "required": ["status"]
          },
          "then": {
            "required": [
              "title",
              "filogram_nwk",
              "microreact_json",
              "chronogram_nwk",
              "mst_html",
              "sequence_filtering_data",
              "sequence_clustering_data",
              "filogram_data",
              "chronogram_data"
            ]
          }
        }
      ]
    }
  },
  "required": ["output"],
  "additionalProperties": false
}

