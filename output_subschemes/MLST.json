{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Subschema for plepiseq output, MLST related data",
  "$comment": "Schemat dla outputu, Podsumowanie typowania w oparciu o dany schemat. Aktualnie do wyboru MLST lub cgMLST.",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "schemat_nazwa": {
        "type": "string",
        "enum": [
          "MLST",
          "cgMLST"
        ],
        "$comment": "Informacja o stosowanym schemacie. Wymagany."
      },
      "komunikat_bledu": {
        "type": "string",
        "$comment": "Dowlny tekst zwracany jako komunikat bledu podczas liczenia profilu. Wymagany, jesli status to Blad"
      },
      "status": {
        "type": "string",
        "enum": [
          "Tak",
          "Nie",
          "Blad"
        ],
        "$comment": "informacja czy policzono profil, niepoliczono, zwrocnono blad. Wymagan"
      },
      "schemat_profile_id": {
        "type": "string",
        "$comment": "Numer zidentyfikowanego profilu."
      },
      "schemat_profile_id_closest": {
        "type": "string",
        "$comment": "Numer profilu z zewnetrznej bazy ktory jest najbardziej zblizony do profilu probki. Wymagany, jesli schemat nazwa to cgMLST"
      },
      "schemat_profile_id_closest_distance": {
        "type": "number",
        "$comment": "Podobienstwo miedzy najblizszym profilem z zewnetrznej bazy a profile probki. Wymagany, jesli schemat nazwa to cgMLST"
      },
      "schemat_profile_allel_list": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "locus_name": {
              "type": "string",
              "$comment": "Naza danego locus. Wymagany."
            },
            "lucus_allel": {
              "type": "number",
              "$comment": "Identyfikator allelu zidentyfikowanego dla danego locus.Wymagany."
            }
          },
          "required": [
            "locus_name",
            "lucus_allel"
          ],
          "comment": "Lista loci i zidentyfikowanych dla nich alleli dla danego profilu. Wymagany."
        },
        "$comment": "Lista"
      },
      "schemat_HierCC_clustering_external": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": [
                "0",
                "2",
                "5",
                "10",
                "20",
                "25",
                "50"
              ],
              "$comment": "Poziom odciecia w trakcie clusteringu. PubMLST wystawia poziomy 5, 10, 25, 50, 100 i 200, inne niz poziomy wystawiane przez Enterobase. Wymagany."
            },
            "group": {
              "type": "string",
              "$comment": "Identyfikator grupy do ktorej nalezy probka na danym poziomie. Wymagany."
            }
          },
          "required": [
            "level",
            "group"
          ],
          "comment": "Przynaleznosc do grupy profili na podstawie podobiensta profilu. Obliczany z wykorzystaniem zewnetrznej bazy (enterobase ub pubmlst) Wymgany, jesli schemat_nazwa to cgMLST"
        },
        "$comment": "Lista"
      },
      "schemat_HierCC_clustering_internal": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": [
                "0",
                "2",
                "5",
                "10",
                "20",
                "25",
                "50"
              ],
              "comment": "Poziom odciecia w trakcie clusteringu. W celu zachowania spojnosci z bazami external zachowuje oryginalna liste poziomow. Wymagany."
            },
            "group": {
              "type": "string",
              "$comment": "Identyfikator grupy. Wymagany"
            }
          },
          "required": [
            "level",
            "group"
          ],
          "comment": "Przynaleznosc do grupy profili na podstawie podobiensta profilu. Obliczany wewnetrznie w PZH. Opcjonalny."
        },
        "$comment": "Lista"
      },
      "schemat_HierCC_historical_data": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": [
                "5",
                "20"
              ],
              "$comment": "Poziom odciecia. Szczepy z publicznej bazy ktore naleza do tej samej grupy na tym poziomie sa analizowane. Wymagany."
            },
            "data": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "kraj": {
                    "type": "string",
                    "$comment": "Nazwa kraju. Wymagany."
                  },
                  "rok": {
                    "type": "number",
                    "$comment": "Rok. Wymagany"
                  },
                  "ilosc": {
                    "type": "number",
                    "$comment": "Liczba szczepow wystepujaca w danym kraju w danym roku. Wymagany."
                  }
                },
                "required": [
                  "kraj",
                  "rok",
                  "ilosc"
                ]
              }
            }
          }
        }
      }
    },
    "required": [
      "schemat_nazwa",
      "status"
    ],
    "allOf": [
      {
        "if": {
          "properties": {
            "status": {
              "const": "Tak"
            }
          }
        },
        "then": {
          "allOf": [
            {
              "required": [
                "schemat_profile_id",
                "schemat_profile_allel_list"
              ]
            },
            {
              "if": {
                "properties": {
                  "schemat_nazwa": {
                    "const": "cgMLST"
                  }
                }
              },
              "then": {
                "required": [
                  "schemat_HierCC_clustering_external",
                  "schemat_profile_id_closest",
                  "schemat_profile_id_closest_distance"
                ]
              }
            }
          ]
        },
        "else": {
          "required": [
            "komunikat_bledu"
          ]
        }
      }
    ]
  }
}
